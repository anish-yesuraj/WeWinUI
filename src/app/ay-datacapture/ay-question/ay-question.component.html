<div class="container">
<div class="row">
<div class="col" style="height: 70px;">

</div>
<div class="w-100"></div>
<div class="col">
<form [formGroup]="questionForm" class="example-form">

    <mat-card>
        <mat-card-header>
            <mat-card-title> New Question </mat-card-title>
            <mat-card-subtitle>Add a new Question to the repository</mat-card-subtitle>
        </mat-card-header>
        
        <mat-divider></mat-divider>
        
        <mat-card-content> 
            
            <div class="row justify-content-around">
                <div class="col-2 align-self-center">
                    <!-- TODO Align the toggle to the left/right of card-title and style the label -->
                    <mat-slide-toggle formControlName="active" labelPosition="before" color="info" style="font-style: normal">
                        Activate
                    </mat-slide-toggle>
                </div>
                <div class="col-2">
                    <mat-form-field class="example-full-width">
                        <mat-label>Grade</mat-label> <!-- TODO Align the dropdown -->
                        <mat-select required formControlName="grade">
                            <mat-option *ngFor="let grade of gradeMaster" [value]="grade.optionId">
                                {{grade.optionName}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-3">
                    <mat-form-field class="example-full-width">
                        <mat-label>Subject</mat-label> <!-- TODO Align the dropdown -->
                        <mat-select required formControlName="subject">
                            <mat-option *ngFor="let subject of subjectMaster" [value]="subject.optionId">
                                {{subject.optionName}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-5">
                    <mat-form-field class="example-full-width">
                        <mat-label>Topic</mat-label>
                        <mat-select formControlName="topic">
                            <mat-option *ngFor="let topic of topicMaster" [value]="topic.optionId">
                                {{topic.optionName}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                
                <div class="w-100"></div>
                
                <div class="col-4">
                    <mat-form-field class="example-full-width">
                        <mat-label>Difficulty level</mat-label>
                        <mat-select formControlName="level">
                            <mat-option *ngFor="let diffLevel of levelMaster" [value]="diffLevel.optionId">
                                {{diffLevel.optionName}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-4">
                    <mat-form-field class="example-full-width"> 
                        <mat-label>Exam Tag</mat-label> <!-- TODO Make this as Chips Autocomplete -->
                        <mat-select required formControlName="examTag">
                            <mat-option *ngFor="let exam of examMaster" [value]="exam.optionId">
                                {{exam.optionName}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="col-4">
                    <mat-form-field class="example-full-width">
                        <mat-label>Source Id</mat-label>
                        <mat-select required formControlName="sourceId">
                            <mat-option *ngFor="let source of sourceMaster" [value]="source.optionId">
                                {{source.optionName}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                
                <div class="w-100"></div>
                
                <div class="col-12">
                    <mat-form-field class="example-full-width">
                        <!-- FIXME TextArea is not resizing -->
                        <textarea matInput required formControlName="text" cdkTextareaAutosize cdkAutosizeMinRows="3" cdkAutosizeMaxRows="5"
                        placeholder="Question text..">
                        </textarea>
                    </mat-form-field>
                </div>
            
                <div class="w-100"></div>
                
                <div class="col-4">
                    <div class="row">
                        <div class="col">
                            <mat-form-field class="example-full-width">
                                <!-- FIXME TextArea is not resizing -->
                                <textarea matInput formControlName="tip" cdkTextareaAutosize cdkAutosizeMinRows="3" cdkAutosizeMaxRows="3"
                                    placeholder="Question tip..(To be displayed along with Question)">
                                </textarea>
                            </mat-form-field>
                        </div>

                        <div class="w-100"></div>
                        
                        <div class="col">
                            <mat-form-field class="example-full-width">
                                <!-- FIXME TextArea is not resizing -->
                                <textarea matInput formControlName="answerExplanation" cdkTextareaAutosize cdkAutosizeMinRows="3" cdkAutosizeMaxRows="3"
                                    placeholder="Answer tip/explanation..(To be displayed during review)">
                                </textarea>
                            </mat-form-field>
                        </div>
                        
                        <div class="w-100"></div>
                        
                        <div class="col">
                            <mat-form-field class="example-full-width">
                                <!-- FIXME TextArea is not resizing -->
                                <textarea matInput formControlName="imageTip" cdkTextareaAutosize cdkAutosizeMinRows="3" cdkAutosizeMaxRows="3"
                                    placeholder="Image tip/caption..">
                                </textarea>
                            </mat-form-field>
                        </div>
                    </div>
                </div>

                <div class="col-8" (paste)="onPaste($event)">
                    <div class="row">
                        <div class="col align-self-end">
                            <div class="text-center"> 
                                <button type="button" class="btn btn-warning btn-sm" (click)="_questionImageFile.click()">Upload Question Image</button>        
                                <input #_questionImageFile hidden type="file" accept="image/*" class="custom-file-input" name="questionImageFile" (change)="handleFileInput($event.target.files)">
                            </div>
                        </div>
                        <div class="w-100"></div>
                        <div class="col align-self-center">
                                <div class="text-center">
                                    <img class="img-thumbnail" style="max-width: 680px; max-height: 200px;" name="questionImage" #_questionImagePreview [src]="imageSrc ? imageSrc : '../../../assets/img/WeWin-192x192.png'">
                                </div>
                            </div>
                        </div>
                </div>

            </div>

            <div class="row justify-content-center" > <!-- Answer Choice List Start -->
                <div class="col-11">
                    <div class="row justify-content-start">
                        <div class="col-11 align-self-center">
                            <h6>List of Choices for the above Question</h6>
                        </div>
                        <div class="col-1 align-self-center">
                            <button mat-mini-fab color="primary" (click)="openAnswerChoice('ADD',{})">
                                <mat-icon>add</mat-icon>
                            </button>
                        </div>
                    </div>
                    <!-- <ng-template #addChoiceMsg>Add Answer/Choice to the list.</ng-template> -->
                    <div class="row justify-content-center mat-elevation-z8">
                        <div class="col-12">
                            <!-- <table mat-table *ngIf="answerChoices && answerChoices.length>0; else addChoiceMsg" [dataSource]="answerChoices" #answerChoicesTable class="example-full-width"> -->
                            <table mat-table [dataSource]="answerChoices" #answerChoicesTable class="example-full-width">
                                <ng-container matColumnDef="clmAnswerResult">
                                    <th mat-header-cell *matHeaderCellDef> Result </th>
                                    <td mat-cell *matCellDef="let element">
                                        <mat-icon *ngIf="element.result">check_circle</mat-icon>
                                        <mat-icon *ngIf="!element.result">highlight_off</mat-icon>
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="clmAnswerText">
                                    <th mat-header-cell *matHeaderCellDef> Text </th>
                                    <td mat-cell *matCellDef="let element"> {{element.text}} </td>
                                </ng-container>
                                <ng-container matColumnDef="clmAnswerImageName">
                                    <th mat-header-cell *matHeaderCellDef> Image Name </th>
                                    <td mat-cell *matCellDef="let element"> {{element.imageName}} </td>
                                </ng-container>
                                <ng-container matColumnDef="clmAnswerImagePreview">
                                    <th mat-header-cell *matHeaderCellDef> Image Preview </th>
                                    <td mat-cell *matCellDef="let element"> 
                                        <img [src]="element.imageSrc" style="max-width: 200px; height: 76px;">
                                    </td>
                                </ng-container>
                                <ng-container matColumnDef="clmAction">
                                    <th mat-header-cell *matHeaderCellDef> Edit/Delete </th>
                                    <td mat-cell *matCellDef="let element">
                                            
                                        <button mat-icon-button color="primary" aria-label="Edit Choice" (click)="openAnswerChoice('UPDATE',element)">
                                            <mat-icon>edit</mat-icon>
                                        </button>
                                        <button mat-icon-button color="warn" aria-label="Delete Choice" (click)="openAnswerChoice('DELETE',element)">
                                            <mat-icon>delete</mat-icon>
                                        </button>
                                    </td>
                                </ng-container>
                                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div> <!-- END of Answer Choice List -->       

        </mat-card-content>

        <mat-card-actions>
            <div class="d-flex justify-content-between">
                <button type="button" raised class="btn btn-success">Submit Question</button>
                <button type="button" raised class="btn btn-secondary">Reset</button>
            </div>
        </mat-card-actions>

    </mat-card>

</form>
</div>
</div>
</div>